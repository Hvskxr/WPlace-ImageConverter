<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WPLACE Pixel Converter</title>
<style>
body{
    font-family:'Inter','Segoe UI',sans-serif;
    margin:0;
    padding:20px;
    background:radial-gradient(circle at top left,#1e293b,#0f172a);
    color:#f1f5f9;
    display:flex;
    flex-direction:column;
    align-items:center;
}

h1{
    margin-bottom:20px;
    font-weight:500;
}

.controls{
    margin-bottom:20px;
    background:rgba(255,255,255,0.05);
    padding:20px;
    border-radius:12px;
    display:flex;
    flex-direction:column;
    gap:12px;
    width:100%;
    max-width:500px;
}

.controls label{
    font-size:14px;
    font-weight:500;
    display:flex;
    flex-direction:column;
    gap:4px;
}

.controls input,
.controls select,
.controls button{
    width:100%;
    padding:10px;
    border:none;
    border-radius:6px;
    font-size:14px;
    background:rgba(255,255,255,0.1);
    color:#f1f5f9;
    outline:none;
    box-sizing:border-box;
}

.controls select{
    background:rgba(255,255,255,0.15);
    color:#f1f5f9;
}

.controls option{
    color:#000;
    background:#fff;
}

.controls button{
    background:linear-gradient(90deg,#38bdf8,#3b82f6);
    font-weight:600;
    transition:.3s;
    cursor:pointer;
}

.controls button:hover{
    transform:translateY(-1px);
    background:linear-gradient(90deg,#0ea5e9,#2563eb);
}

.container{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:20px;
    width:100%;
    max-width:1000px;
}

.preview-box{
    background:rgba(255,255,255,0.05);
    border-radius:12px;
    padding:10px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    aspect-ratio:1/1;
    flex:1 1 45%;
    min-width:250px;
}

.preview-box .title{
    text-align:center;
    font-size:14px;
    color:#f1f5f9;
    margin-bottom:8px;
}

canvas,
img{
    width:100%;
    height:100%;
    object-fit:contain;
    border-radius:8px;
    image-rendering:pixelated;
}

footer{
    margin-top:30px;
    font-size:12px;
    color:#94a3b8;
}
</style>
</head>
<body>
<h1>WPLACE Pixel Converter</h1>

<div class="controls">
  <label>Palette:
    <select id="palette">
      <option value="free">Free</option>
      <option value="premium">Premium</option>
    </select>
  </label>
  <label>Image:
    <input type="file" id="imgFile" accept="image/*">
  </label>
  <label>Width: <input type="number" id="w" value="50"></label>
  <label>Height: <input type="number" id="h" value="50"></label>
  <label>Mode:
    <select id="mode">
      <option value="none">None</option>
      <option value="grid">Grid</option>
      <option value="num-grid">Number+Grid</option>
    </select>
  </label>
  <button id="go">Convert</button>
</div>

<div class="container">
  <div class="preview-box">
    <div class="title">Before</div>
    <img id="orig" alt="Original Image">
  </div>
  <div class="preview-box">
    <div class="title">After</div>
    <canvas id="canvas"></canvas>
  </div>
</div>
<footer>Â© Hvskxr</footer>

<script>
// PALETTES
const freebieColors = [
  '#000','#3c3c3c','#787878','#d2d2d2','#fff','#600018','#ed1c24','#ff7f27',
  '#f6aa09','#f9dd3b','#fffabc','#0eb968','#13e67b','#87ff5e','#0c816e','#10ae82',
  '#13e1be','#60f7f2','#28509e','#4093e4','#6b50f6','#99b1fb','#780c99','#aa38b9',
  '#e09ff9','#cb007a','#ec1f80','#f38da9','#684634','#95682a','#f8b277','transparent'
].map(h=>h2rgb(h));

const premiumStuff = freebieColors.concat([
  '#ffb6c1','#add8e6','#90ee90','#ffa500','#800080','#808000','#008080','#ff4500',
  '#c71585','#7fffd4','#ff69b4','#cd5c5c','#40e0d0','#1e90ff','#f5f5dc','#ffe4c4','#ffefd5'
].map(h=>h2rgb(h)));

// UTILS
function h2rgb(hexish){
  if(hexish==='transparent') return [0,0,0,0];
  let n=parseInt(hexish.slice(1),16);
  return [(n>>16)&255,(n>>8)&255,n&255];
}

function closestColor(toMe, palette){
  let pick=toMe, minDist=Infinity;
  for(let candidate of palette){
    let d=Math.hypot(toMe[0]-candidate[0],toMe[1]-candidate[1],toMe[2]-candidate[2]);
    if(d<minDist){minDist=d; pick=candidate;}
  }
  return pick;
}

// DOM
const fileChooser = document.getElementById('imgFile');
const origImg = document.getElementById('orig');
const canvasEl = document.getElementById('canvas');
const ctxEl = canvasEl.getContext('2d');

fileChooser.addEventListener('change', e=>{
  const f=e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload=ev=>origImg.src=ev.target.result;
  reader.readAsDataURL(f);
});

document.getElementById('go').addEventListener('click', ()=>{
  const f=fileChooser.files[0];
  if(!f) return alert('Pick a file first.');
  const w=parseInt(document.getElementById('w').value);
  const h=parseInt(document.getElementById('h').value);
  const mode=document.getElementById('mode').value;
  const palette=document.getElementById('palette').value==='free'?freebieColors:premiumStuff;

  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const miniCanvas=document.createElement('canvas');
      miniCanvas.width=w; miniCanvas.height=h;
      const miniCtx=miniCanvas.getContext('2d');
      miniCtx.drawImage(img,0,0,w,h);
      const imgData=miniCtx.getImageData(0,0,w,h);
      const idxList=[];
      for(let i=0;i<imgData.data.length;i+=4){
        const rgb=[imgData.data[i],imgData.data[i+1],imgData.data[i+2]];
        const c=closestColor(rgb,palette);
        imgData.data[i]=c[0]; imgData.data[i+1]=c[1]; imgData.data[i+2]=c[2];
        idxList.push(palette.findIndex(p=>p[0]===c[0]&&p[1]===c[1]&&p[2]===c[2]));
      }
      miniCtx.putImageData(imgData,0,0);

      const scale=30;
      canvasEl.width=w*scale; canvasEl.height=h*scale;
      ctxEl.imageSmoothingEnabled=false;
      ctxEl.clearRect(0,0,canvasEl.width,canvasEl.height);
      ctxEl.drawImage(miniCanvas,0,0,canvasEl.width,canvasEl.height);

      if(mode==='grid'||mode==='num-grid'){
        ctxEl.strokeStyle='rgba(255,255,255,0.3)'; ctxEl.lineWidth=1;
        for(let x=0;x<=w;x++){ctxEl.beginPath();ctxEl.moveTo(x*scale,0);ctxEl.lineTo(x*scale,h*scale);ctxEl.stroke();}
        for(let y=0;y<=h;y++){ctxEl.beginPath();ctxEl.moveTo(0,y*scale);ctxEl.lineTo(w*scale,y*scale);ctxEl.stroke();}
      }

      if(mode==='num-grid'){
        ctxEl.font=`${scale/2}px monospace`; ctxEl.fillStyle='#fff';
        ctxEl.textAlign='center'; ctxEl.textBaseline='middle';
        for(let y=0;y<h;y++){
          for(let x=0;x<w;x++){
            ctxEl.fillText(idxList[y*w+x],x*scale+scale/2,y*scale+scale/2);
          }
        }
      }
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(f);
});
</script>
</body>
</html>
